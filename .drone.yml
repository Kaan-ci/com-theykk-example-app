---
global-variables:
  .login_docker: &login_docker |
    echo "${PASSWORD}" | docker login -u ykk --password-stdin theykk.com
  environment: &default_environment
    PASSWORD:
      from_secret: password
    CONTAINER_GENERAL_IMAGE: "theykk.com/ykk/test:${DRONE_BRANCH}_${DRONE_COMMIT_SHA}"
    CONTAINER_TAGGED_IMAGE: "theykk.com/ykk/test:${DRONE_TAG}"
    CONTAINER_LATEST_IMAGE: "theykk.com/ykk/test:latest"

kind: pipeline
type: kubernetes
name: default

clone:
  disable: true
  
# steps:
# - name: test
#   pull: if-not-exists
#   image: alpine
#   environment:
#     PASSWORD:
#       from_secret: password
#   commands:
#   - echo hello
#   - echo world
#   - env
#   - echo $PASSWORD4 | base64
#   - exit 0
steps:
- name: build test image
  image: docker
  tty: true
  environment:
    <<: *default_environment
  commands:
    - *login_docker
    - docker build -t ${CONTAINER_GENERAL_IMAGE} .
---
kind: secret
name: password
get:
  path: com-theykk-drone-example
  name: password